{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Members" %} — {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-10">

  <h1 class="text-3xl font-bold mb-8">{% trans "Members" %}</h1>

  {% if messages %}
  {% for message in messages %}
  <div role="alert" class="alert alert-{{ message.tags|default:'info' }} mb-6" aria-live="polite">
    <span>{{ message }}</span>
  </div>
  {% endfor %}
  {% endif %}

  {# Invite member card #}
  <div class="card bg-base-100 shadow-lg mb-8">
    <div class="card-body">
      <h2 class="card-title text-xl mb-4">{% trans "Invite a member" %}</h2>
      <form method="post" action="{% url 'users:invite_member' %}" novalidate>
        {% csrf_token %}
        <div class="flex gap-3 items-end flex-wrap">
          <fieldset class="fieldset flex-1 min-w-64">
            <label class="label" for="id_invite_email">
              <span class="label-text">{% trans "Email address" %}</span>
            </label>
            <input
              type="email"
              id="id_invite_email"
              name="email"
              class="input w-full text-base"
              autocomplete="off"
              placeholder="colleague@example.com"
              required
            >
          </fieldset>
          <button type="submit" class="btn btn-primary min-h-[44px]">
            {% trans "Send invite" %}
          </button>
        </div>
      </form>
    </div>
  </div>

  {# Members table #}
  <div class="card bg-base-100 shadow-lg">
    <div class="card-body p-0">
      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>{% trans "Email" %}</th>
              <th>{% trans "Name" %}</th>
              <th>{% trans "Role" %}</th>
              <th>{% trans "Status" %}</th>
              <th class="text-right">{% trans "Actions" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for member in members %}
            <tr>
              <td class="font-mono text-sm">{{ member.user.email }}</td>
              <td>{{ member.display_name|default:"—" }}</td>
              <td>
                {% if member.role == "admin" %}
                <span class="badge badge-primary">{% trans "Admin" %}</span>
                {% else %}
                <span class="badge badge-ghost">{% trans "Member" %}</span>
                {% endif %}
              </td>
              <td>
                {% if member.is_active %}
                <span class="badge badge-success">{% trans "Active" %}</span>
                {% else %}
                <span class="badge badge-error">{% trans "Revoked" %}</span>
                {% endif %}
              </td>
              <td class="text-right">
                {% if member.pk != admin_profile.pk %}
                  {% if member.is_active %}
                  <form method="post" action="{% url 'users:revoke_member' member.pk %}" class="inline">
                    {% csrf_token %}
                    <button
                      type="submit"
                      class="btn btn-sm btn-error btn-outline min-h-[44px]"
                      onclick="return confirm('{% trans "Revoke access for this member?" %}')"
                    >
                      {% trans "Revoke" %}
                    </button>
                  </form>
                  {% else %}
                  <form method="post" action="{% url 'users:reengage_member' member.pk %}" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success btn-outline min-h-[44px]">
                      {% trans "Re-engage" %}
                    </button>
                  </form>
                  {% endif %}
                {% else %}
                <span class="text-sm opacity-50">{% trans "You" %}</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center opacity-50 py-8">
                {% trans "No members yet. Invite someone above." %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
