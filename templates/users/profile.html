{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Profile" %} — {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-10">

  <h1 class="text-3xl font-bold mb-8">{% trans "Profile" %}</h1>

  {% if messages %}
  {% for message in messages %}
  <div role="alert" class="alert alert-{{ message.tags|default:'info' }} mb-6" aria-live="polite">
    <span>{{ message }}</span>
  </div>
  {% endfor %}
  {% endif %}

  <form method="post" action="{% url 'users:profile' %}" novalidate>
    {% csrf_token %}

    <div class="card bg-base-100 shadow-lg mb-6">
      <div class="card-body gap-5">
        <h2 class="card-title text-xl">{% trans "Personal information" %}</h2>

        <fieldset class="fieldset">
          <label class="label" for="id_display_name">
            <span class="label-text">{% trans "Display name" %}</span>
          </label>
          <input
            type="text"
            id="id_display_name"
            name="display_name"
            value="{{ form.display_name.value|default:'' }}"
            class="input w-full text-base{% if form.display_name.errors %} input-error{% endif %}"
            autocomplete="name"
            {% if form.display_name.errors %}aria-invalid="true" aria-describedby="display-name-error"{% endif %}
          >
          {% if form.display_name.errors %}
          <p id="display-name-error" class="label-text text-error mt-1">{{ form.display_name.errors|join:" " }}</p>
          {% endif %}
        </fieldset>

        <fieldset class="fieldset">
          <label class="label" for="id_language">
            <span class="label-text">{% trans "Language" %}</span>
          </label>
          <select
            id="id_language"
            name="language"
            class="select w-full text-base{% if form.language.errors %} select-error{% endif %}"
          >
            <option value="">{% trans "— Select language —" %}</option>
            {% for lang in form.language.field.queryset %}
            <option value="{{ lang.pk }}" {% if form.language.value|stringformat:"s" == lang.pk|stringformat:"s" %}selected{% endif %}>
              {{ lang.name }}
            </option>
            {% endfor %}
          </select>
        </fieldset>

        <fieldset class="fieldset">
          <label class="label" for="id_timezone">
            <span class="label-text">{% trans "Timezone" %}</span>
          </label>
          <select
            id="id_timezone"
            name="timezone"
            class="select w-full text-base{% if form.timezone.errors %} select-error{% endif %}"
          >
            <option value="">{% trans "— Select timezone —" %}</option>
            {% for tz in form.timezone.field.queryset %}
            <option value="{{ tz.pk }}" {% if form.timezone.value|stringformat:"s" == tz.pk|stringformat:"s" %}selected{% endif %}>
              {{ tz.label }}
            </option>
            {% endfor %}
          </select>
        </fieldset>

        <fieldset class="fieldset">
          <label class="label" for="id_country">
            <span class="label-text">{% trans "Country" %}</span>
          </label>
          <select
            id="id_country"
            name="country"
            class="select w-full text-base{% if form.country.errors %} select-error{% endif %}"
          >
            <option value="">{% trans "— Select country —" %}</option>
            {% for c in form.country.field.queryset %}
            <option value="{{ c.pk }}" {% if form.country.value|stringformat:"s" == c.pk|stringformat:"s" %}selected{% endif %}>
              {{ c.name }}
            </option>
            {% endfor %}
          </select>
        </fieldset>

        <fieldset class="fieldset">
          <label class="label" for="id_currency">
            <span class="label-text">{% trans "Currency" %}</span>
          </label>
          <select
            id="id_currency"
            name="currency"
            class="select w-full text-base{% if form.currency.errors %} select-error{% endif %}"
          >
            <option value="">{% trans "— Select currency —" %}</option>
            {% for cur in form.currency.field.queryset %}
            <option value="{{ cur.pk }}" {% if form.currency.value|stringformat:"s" == cur.pk|stringformat:"s" %}selected{% endif %}>
              {{ cur.code }} — {{ cur.name }}
            </option>
            {% endfor %}
          </select>
        </fieldset>

      </div>
    </div>

    <div class="card bg-base-100 shadow-lg mb-6">
      <div class="card-body gap-5">
        <h2 class="card-title text-xl">{% trans "Appearance" %}</h2>

        <fieldset class="fieldset">
          <label class="label" for="id_theme">
            <span class="label-text">{% trans "Theme" %}</span>
          </label>
          <select
            id="id_theme"
            name="theme"
            class="select w-full text-base"
          >
            {% for value, label in form.theme.field.choices %}
            <option value="{{ value }}" {% if form.theme.value == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </fieldset>

      </div>
    </div>

    <div class="card bg-base-100 shadow-lg mb-8">
      <div class="card-body gap-5">
        <h2 class="card-title text-xl">{% trans "Communication" %}</h2>

        <fieldset class="fieldset">
          <label class="label cursor-pointer justify-start gap-4">
            <input
              type="checkbox"
              id="id_marketing_emails"
              name="marketing_emails"
              class="checkbox"
              {% if form.marketing_emails.value %}checked{% endif %}
            >
            <span class="label-text">{% trans "Receive marketing emails and product news" %}</span>
          </label>
        </fieldset>

      </div>
    </div>

    <button type="submit" class="btn btn-primary min-h-[44px] px-8">
      {% trans "Save changes" %}
    </button>

  </form>

</div>
{% endblock %}

{% block extra_js %}
<script>
  // After a profile save the page reloads — sync localStorage to the newly saved theme.
  (function () {
    var saved = '{{ saved_theme|escapejs }}';
    if (saved) {
      localStorage.setItem('theme', saved);
    }
  })();
</script>
{% endblock %}
