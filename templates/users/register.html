{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Create account" %} — {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-4 py-12">
  <div class="w-full max-w-md">

    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold">{% trans "Create your account" %}</h1>
      <p class="mt-2 opacity-70">{% trans "Start your free trial today" %}</p>
    </div>

    <div class="card bg-base-100 shadow-lg">
      <div class="card-body gap-6">

        <form method="post" action="{% url 'users:register' %}" novalidate>
          {% csrf_token %}

          <fieldset class="fieldset">
            <label class="label" for="id_email">
              <span class="label-text">{% trans "Email address" %}</span>
            </label>
            <input
              type="email"
              id="id_email"
              name="email"
              value="{{ form.email.value|default:'' }}"
              class="input w-full text-base{% if form.email.errors %} input-error{% endif %}"
              autocomplete="email"
              autofocus
              required
              {% if form.email.errors %}aria-invalid="true" aria-describedby="email-error"{% endif %}
            >
            {% if form.email.errors %}
            <p id="email-error" class="label-text text-error mt-1">{{ form.email.errors|join:" " }}</p>
            {% endif %}
          </fieldset>

          <fieldset class="fieldset mt-4">
            <label class="label" for="id_password">
              <span class="label-text">{% trans "Password" %}</span>
            </label>
            <input
              type="password"
              id="id_password"
              name="password"
              class="input w-full text-base{% if form.password.errors %} input-error{% endif %}"
              autocomplete="new-password"
              required
              {% if form.password.errors %}aria-invalid="true" aria-describedby="password-error"{% endif %}
            >
            {% if form.password.errors %}
            <p id="password-error" class="label-text text-error mt-1">{{ form.password.errors|join:" " }}</p>
            {% endif %}
          </fieldset>

          {# Hidden fields populated by JS for timezone / language / country detection #}
          <input type="hidden" name="tz_detect" id="id_tz_detect">
          <input type="hidden" name="lang_detect" id="id_lang_detect">
          <input type="hidden" name="country_detect" id="id_country_detect">

          <div class="mt-6">
            <button type="submit" class="btn btn-primary w-full min-h-[44px]">
              {% trans "Create account" %}
            </button>
          </div>
        </form>

      </div>
    </div>

    <p class="text-center mt-6 text-sm opacity-70">
      {% trans "Already have an account?" %}
      <a href="{% url 'users:login' %}" class="link link-primary font-medium">{% trans "Sign in" %}</a>
    </p>

  </div>
</div>

<script>
  (function () {
    try {
      var tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
      if (tz) document.getElementById("id_tz_detect").value = tz;
    } catch (e) {}
    try {
      var lang = navigator.language || navigator.userLanguage;
      if (lang) {
        document.getElementById("id_lang_detect").value = lang;
        // Extract region subtag if present: "nl-BE" → "BE", "en-US" → "US"
        var parts = lang.split("-");
        if (parts.length >= 2) {
          document.getElementById("id_country_detect").value = parts[parts.length - 1].toUpperCase();
        }
      }
    } catch (e) {}
  })();
</script>
{% endblock %}
